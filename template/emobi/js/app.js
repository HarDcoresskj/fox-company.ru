var brand_filters=[],arr_filters=[],basket=[],favorite=[],remove_bonus=0;class QuickSearch{constructor(){let e=document.querySelectorAll(".quick-search");for(let t=0;t<e.length;t++)e[t].addEventListener("keyup",(i=>{let n=e[t].closest(".item").querySelectorAll(".checkbox"),o=e[t].value.toUpperCase();for(let e=0;e<n.length;e++){let t=n[e];-1==t.querySelector("label").textContent.toUpperCase().indexOf(o)?t.hidden=""!=o&&" "!=o:t.hidden=!1}}))}}const Search=new QuickSearch;function calc_bonus_steep3(){if(1==$.cookie("basket_remove_bonus")||1==remove_bonus){let e=parseInt($(".newBasketSteep3 .total price").html())-parseInt($(".newBasketSteep3 .js-user-bonus").val());$(".newBasketSteep3 .total span").html("Итого к оплате с бонусами:"),$(".newBasketSteep3 .total price").html(e)}}function calc_bonus(){let e=$(".total price").html(),t=$(".bonus div:first-child price").html();console.log("bonus = "+t);let i=e-t;if(console.log("pre + "+remove_bonus),1==$.cookie("basket_remove_bonus")||1==remove_bonus){console.log("calc + "+remove_bonus);let n=t-e;n>0?$(".bonus div:first-child price").html(n):$(".bonus div:first-child price").html("0"),$(".bonus div:nth-child(2)").css("display","none"),$(".bonus div:nth-child(3)").css("display","none"),i=e-parseInt($(".bonus div:first-child price").data("id")),console.log("with_bonus = "+i),i<0&&(i=1),$(".total price").html(i)}0!=t&&(i<0&&(i=1),console.log("with_bonus = "+i),$(".bonus div:nth-child(3) price").html(i))}if($(".slider").length&&$(".slider").slick({infinite:!0,slidesToShow:1,slidesToScroll:1,autoplay:!0,autoplaySpeed:2e3,arrows:!0}),$(".slider-items").length&&$(".slider-items").slick({infinite:!0,slidesToShow:4,slidesToScroll:1,autoplay:!1,autoplaySpeed:2e3,arrows:!0,responsive:[{breakpoint:900,settings:{slidesToShow:3,slidesToScroll:1},breakpoint:700,settings:{slidesToShow:2,slidesToScroll:1}}]}),$(".blog-slider").length&&$(".blog-slider").slick({infinite:!0,slidesToShow:3,slidesToScroll:1,autoplay:!1,autoplaySpeed:2500,arrows:!0,responsive:[{breakpoint:700,settings:{slidesToShow:1,slidesToScroll:1}}]}),$(".product-slider-for").length&&($(".product-slider-for").slick({slidesToShow:1,slidesToScroll:1,arrows:!0,fade:!0,asNavFor:".product-slider-nav"}),$(".product-slider-nav").slick({slidesToShow:4,slidesToScroll:1,asNavFor:".product-slider-for",dots:!0,centerMode:!0,focusOnSelect:!0})),$(document).ready((function(){if(document.querySelector(".product-info-modifications")){let e=document.querySelector(".product-info-modifications"),t=e.dataset.id;$.ajax({type:"POST",async:!0,url:"https://"+window.location.hostname+"/ajax/getproductmodifications/",dataType:"json",data:"article="+t,success:function(t){let i=e.querySelector("ul");t.forEach((e=>{$(i).append(`<li class="flex"><a href="/product/${e.url}/">${e.name}</a><span>${e.price} руб.</span></li>`)})),t.length>0&&e.classList.add("active")}})}check_favorite(),$(".js-checkArt").length&&checkPriceFromBase($(".js-checkArt").data("id")),$(".filters").length&&render_filters(null),$(".site_message").length&&setTimeout((()=>{$(".site_message").slideUp("slow")}),3e3),$(".bonus").length&&calc_bonus(),$(".newBasketSteep3").length&&calc_bonus_steep3(),$(".remove-bonus").on("click",(function(e){$.cookie("basket_remove_bonus",1,{expires:1,path:"/"}),remove_bonus=1,location.reload()})),$(".js-add-link").on("click",(function(e){$(".link-list").append('<input type="text" name="links[]" >')})),$(".add-to-favorite, .add_favorite").on("click",(function(e){console.log($.cookie("favorite")),$(this).toggleClass("active");let t=$(this).data("id");$.cookie("favorite")?(favorite=JSON.parse($.cookie("favorite")),$(this).hasClass("active")?favorite.push(t):favorite=favorite.filter((function(e){return console.log("333333"),e!==t}))):(console.log("new"),favorite.push(t)),favorite=favorite.filter(onlyUnique),console.log(favorite),$.cookie("favorite",JSON.stringify(favorite),{expires:7,path:"/"})})),$(".phoenix").mask("(071) 999-99-99"),$(".product-del").on("click",(function(e){confirm("Удалить товар из корзины?")&&($(this).parents(".p-item").remove(),render_basket(),total_basket_price())})),$(".info .counter span:last-child").on("click",(function(e){let t=$(this).siblings("input").val();if(t<5){t++,$(this).siblings("input").val(t);let e=$(this).parents(".info").find("price").data("id");e*=t,e=$(this).parents(".info").find("price").html(e),render_basket(!1),total_basket_price(),calc_bonus()}})),$(".info .counter span:first-child").on("click",(function(e){let t=$(this).siblings("input").val();if(t>1){t--,$(this).siblings("input").val(t);let e=$(this).parents(".info").find("price").data("id");e*=t,e=$(this).parents(".info").find("price").html(e),render_basket(!1),total_basket_price(),calc_bonus()}})),$.cookie("basket")&&(basket=JSON.parse($.cookie("basket")),console.log(basket),parse_basket()),$(".add-to-basket").on("click",(function(e){let t=$(this).data("id"),i=$(this).data("cnt"),n=[t,$(this).data("price"),i];basket.push(n),$.cookie("basket",JSON.stringify(basket),{expires:7,path:"/"}),parse_basket(),$(".basket-total").slideDown("slow"),$("body,html").animate({scrollTop:0},400)})),$.modal.defaults={fadeDuration:100,fadeDelay:1},$("select").length&&$("select").styler(),$(".custom-scroll").length&&$(".custom-scroll").mCustomScrollbar(),$(".show-filters-btn, .close-filter-btn").on("click",(function(e){$("section.product-list .filters").toggleClass("active"),$("section.product-list .overlay").toggleClass("active"),$("body").toggleClass("overflow-hidden")})),$("#f_brand").find("input:checked").each((function(e,t){$(t).prop("checked")&&brand_filters.push($(t).val())})),$(".filter_default").find("input:checked").each((function(e,t){$(t).prop("checked")&&arr_filters.push($(t).val())})),$(".product-info ._tabs a").on("click",(function(e){$(".product-info ._tabs a").removeClass("active"),$(this).addClass("active"),$(this).hasClass("rev")?($(".character-list").addClass("hidden"),$(".review-list").removeClass("hidden")):($(".character-list").removeClass("hidden"),$(".review-list").addClass("hidden")),dn=$("#goto").offset().top,$("html, body").animate({scrollTop:dn},1e3)})),$("#f_brand .f_ch").on("click",(function(e){let t=!1,i=$(this).val();for(var n=0;n<brand_filters.length;n++)i===brand_filters[n]&&(brand_filters.splice(n,1),t=!0);t||brand_filters.push($(this).val())})),$(".o-item .header").on("click",(function(e){$(this).parent("div").find(".info").slideToggle(300),$(this).find("a").toggleClass("rotate")})),$(".list-sort").change((function(){location.search="?sort="+$(".list-sort option:selected").val()})),$(".apply-filters, .tooltiptext").on("click",(function(e){arr_filters=collection_filters();let t="";brand_filters.length>0&&(t+="brand=",t+=brand_filters.join(",")+";"),""!=$(".fprice-ot").val()?price_ot=$(".fprice-ot").val():price_ot=0,""!=$(".fprice-do").val()?price_do=$(".fprice-do").val():price_do=1e5,0==price_ot&&1e5==price_do||(t+="price="+price_ot+","+price_do+";"),arr_filters.length>0?(t+="filter=",t+=arr_filters):t=t.substring(0,t.length-1);let i=window.location.pathname.split("/");console.log(i),location=window.location.protocol+"//"+window.location.host+"/"+i[1]+"/"+t+"/"})),$(".buttons a.cansel").on("click",(function(e){let t=window.location.pathname.split("/");console.log(t),location=window.location.protocol+"//"+window.location.host+"/"+t[1]+"/"})),$(".overlay").on("click",(function(e){$("section.product-list .filters").toggleClass("active"),$(this).toggleClass("active"),$("body").toggleClass("overflow-hidden")})),$("section.catalog-menu .menu_list h4").on("click",(function(e){$("section.catalog-menu .menu_list ul").slideToggle(300,(function(){$(this).is(":visible")&&$(this).css("display","flex")}))}))})),document.querySelector(".js-add-order")){let e=document.querySelector(".js-add-order");e.addEventListener("click",(function(){document.querySelector(".p-item")?e.classList.contains("not-active")?e.setAttribute("type","button"):(e.setAttribute("type","submit"),setTimeout((function(){e.disabled=!0}),100),setTimeout((function(){e.disabled=!1}),1e3)):(e.disabled=!0,alert("В корзине нет товаров!"))}))}function checkPriceFromBase(e){""!=e&&$.ajax({type:"POST",async:!0,url:"https://"+window.location.hostname+"/ajax/checkPriceFromBase/",dataType:"html",data:"url="+e,success:function(e){if(0==parseInt(e)){let e=document.createElement("div");e.innerHTML="<h5>Извините товара нет в наличии на складе!</h5>",e.classList.add("warningProduct"),document.body.appendChild(e)}}})}function check_duplicate_phone(e,t){""!=e&&$.ajax({type:"POST",async:!0,url:"https://"+window.location.hostname+"/ajax/check_duplicate_phone/",dataType:"html",data:"phone="+e,success:function(e){"ok"!=e?($("<div class='form_warning'>"+e+"</div>").insertAfter(t),document.querySelector(".regBtn").classList.add("hidden")):($(".form_warning").remove(),document.querySelector(".regBtn").classList.remove("hidden"))}})}function check_duplicate_mail(e,t){""!=e&&$.ajax({type:"POST",async:!0,url:"https://"+window.location.hostname+"/ajax/check_duplicate_mail/",dataType:"html",data:"phone="+e,success:function(e){"ok"!=e?($("<div class='form_warning'>"+e+"</div>").insertAfter(t),document.querySelector(".regBtn").classList.add("hidden"),console.log("DUPLICATE")):($(".form_warning").remove(),document.querySelector(".regBtn").classList.remove("hidden"))}})}function check_favorite(){$.cookie("favorite")&&(favorite=JSON.parse($.cookie("favorite"))).forEach((function(e,t){$('.add-to-favorite[data-id="'+e+'"]').addClass("active"),$('.add_favorite[data-id="'+e+'"]').addClass("active")}))}function render_basket(e=!0){basket=[],$(".products .list").find(".p-item").each((function(e,t){let i=[$(t).data("id"),$(t).find("price").data("id"),$(t).find("input").val()];basket.push(i)})),$.cookie("basket",JSON.stringify(basket),{expires:7,path:"/"}),e&&location.reload()}function parse_basket(){(basket=JSON.parse($.cookie("basket"))).length>0&&($(".header-basket span").html("Корзина ("+basket.length+")"),$(".basket-total p").html("в корзине "+basket.length+" товара"))}function total_basket_price(){let e=0;$(".products .list").find(".p-item").each((function(t,i){e+=parseInt($(i).find("price").data("id"))*parseInt($(i).find("input").val())})),console.log("*******"+e),$(".total price").html(e)}function collection_filters(){let e="",t=!1;return $(".filter_default").each((function(i,n){let o=!1;$(n).find("input:checked").each((function(i,n){e+=$(n).val()+",",o=!0,t=!0})),o&&(e=e.substring(0,e.length-1),e+=":")})),t?e.substring(0,e.length-1):[]}function ShowTooltips(e,t){$(".tooltiptext").removeClass("hov"),t.parent("div").find("span").addClass("hov"),render_filters(t)}function onlyUnique(e,t,i){return i.indexOf(e)===t}function render_filters(e){let t="",i="",n=!1;$(".filter_brands").find("input:checked").each((function(e,t){i+=$(t).val()+","})),i=i.substring(0,i.length-1),$(".filters").find(".filter_default").each((function(e,i){$(i).find("input:checked").each((function(e,i){t+=$(i).val()+",",n=!0})),n&&(t=t.substring(0,t.length-1),t+=":"),n=!1})),t=t.substring(0,t.length-1);var o=null;null!=e&&(o=e.parents(".filter_default").attr("id")),$.ajax({type:"POST",async:!0,url:"https://"+window.location.hostname+"/ajax/render_filters/",dataType:"json",data:"f="+t+"&b="+i+"&pathname="+window.location.pathname,success:function(t){null!=e&&e.parent("div").find("span").html(t.cnt+" шт. Показать?");let i=t.active_filters,n=t.active_brands;null!=e?(null!=o&&($(".filter_brands .custom-checkbox").attr("disabled",!0),$(".filter_brands .custom-checkbox").parent(".checkbox").addClass("disable")),$(".filter_default:not(#"+o+") .custom-checkbox").attr("disabled",!0),$(".filter_default:not(#"+o+") .custom-checkbox").parent(".checkbox").addClass("disable")):($(".custom-checkbox").attr("disabled",!0),$(".custom-checkbox").parent(".checkbox").addClass("disable")),$.each(i,(function(e,t){$("#f_ch_"+t).attr("disabled",!1),$("#f_ch_"+t).parent(".checkbox").removeClass("disable")})),$.each(n,(function(e,t){$("#fb_ch_"+t).attr("disabled",!1),$("#fb_ch_"+t).parent(".checkbox").removeClass("disable")}))}})}jQuery.cookie=function(e,t,i){if(void 0===t){var n=null;if(document.cookie&&""!=document.cookie)for(var o=document.cookie.split(";"),a=0;a<o.length;a++){var r=jQuery.trim(o[a]);if(r.substring(0,e.length+1)==e+"="){n=decodeURIComponent(r.substring(e.length+1));break}}return n}i=i||{},null===t&&(t="",i.expires=-1);var s,l="";i.expires&&("number"==typeof i.expires||i.expires.toUTCString)&&("number"==typeof i.expires?(s=new Date).setTime(s.getTime()+24*i.expires*60*60*1e3):s=i.expires,l="; expires="+s.toUTCString());var c=i.path?"; path="+i.path:"",d=i.domain?"; domain="+i.domain:"",u=i.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),l,c,d,u].join("")},function(e){for(var t=function e(t,i){return t&&(i(t)?t:e(t.parentNode,i))},i=function(e){(e=e||window.event).preventDefault?e.preventDefault():e.returnValue=!1;var i=e.target||e.srcElement,o=t(i,(function(e){return"A"===e.tagName}));if(o){for(var a,r=o.parentNode,s=o.parentNode.childNodes,l=s.length,c=0,d=0;d<l;d++)if(1===s[d].nodeType){if(s[d]===o){a=c;break}c++}return a>=0&&n(a,r),!1}},n=function(e,t,i,n){var o,a,r,s=document.querySelectorAll(".pswp")[0];if(r=function(e){for(var t,i,n,o=e.childNodes,a=o.length,r=[],s=0;s<a;s++)if(1===(e=o[s]).nodeType){t=e.children,i=e.getAttribute("data-size").split("x"),(n={src:e.getAttribute("href"),w:parseInt(i[0],10),h:parseInt(i[1],10),author:e.getAttribute("data-author")}).el=e,t.length>0&&(n.msrc=t[0].getAttribute("src"),t.length>1&&(n.title=t[1].innerHTML));var l=e.getAttribute("data-med");l&&(i=e.getAttribute("data-med-size").split("x"),n.m={src:l,w:parseInt(i[0],10),h:parseInt(i[1],10)}),n.o={src:n.src,w:n.w,h:n.h},r.push(n)}return r}(t),a={galleryUID:t.getAttribute("data-pswp-uid"),getThumbBoundsFn:function(e){var t=r[e].el.children[0],i=window.pageYOffset||document.documentElement.scrollTop,n=t.getBoundingClientRect();return{x:n.left,y:n.top+i,w:n.width}},addCaptionHTMLFn:function(e,t,i){return e.title?(t.children[0].innerHTML=e.title+"<br/><small>Photo: "+e.author+"</small>",!0):(t.children[0].innerText="",!1)}},n)if(a.galleryPIDs){for(var l=0;l<r.length;l++)if(r[l].pid==e){a.index=l;break}}else a.index=parseInt(e,10)-1;else a.index=parseInt(e,10);if(!isNaN(a.index)){for(var c=document.getElementsByName("gallery-style"),d=0,u=c.length;d<u;d++)if(c[d].checked){"radio-all-controls"==c[d].id||"radio-minimal-black"==c[d].id&&(a.mainClass="pswp--minimal--dark",a.barsSize={top:0,bottom:0},a.captionEl=!1,a.fullscreenEl=!1,a.shareEl=!1,a.bgOpacity=.85,a.tapToClose=!0,a.tapToToggleControls=!1);break}i&&(a.showAnimationDuration=0),o=new PhotoSwipe(s,PhotoSwipeUI_Default,r,a);var f,h,p=!1,m=!0;o.listen("beforeResize",(function(){var e=window.devicePixelRatio?window.devicePixelRatio:1;e=Math.min(e,2.5),(f=o.viewportSize.x*e)>=1200||!o.likelyTouchDevice&&f>800||screen.width>1200?p||(p=!0,h=!0):p&&(p=!1,h=!0),h&&!m&&o.invalidateCurrItems(),m&&(m=!1),h=!1})),o.listen("gettingData",(function(e,t){p?(t.src=t.o.src,t.w=t.o.w,t.h=t.o.h):(t.src=t.m.src,t.w=t.m.w,t.h=t.m.h)})),o.init()}},o=document.querySelectorAll(e),a=0,r=o.length;a<r;a++)o[a].setAttribute("data-pswp-uid",a+1),o[a].onclick=i;var s=function(){var e=window.location.hash.substring(1),t={};if(e.length<5)return t;for(var i=e.split("&"),n=0;n<i.length;n++)if(i[n]){var o=i[n].split("=");o.length<2||(t[o[0]]=o[1])}return t.gid&&(t.gid=parseInt(t.gid,10)),t}();s.pid&&s.gid&&n(s.pid,o[s.gid-1],!0,!0)}(".demo-gallery"),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}((function(e){var t,i=navigator.userAgent,n=/iphone/i.test(i),o=/chrome/i.test(i),a=/android/i.test(i);e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},autoclear:!0,dataName:"rawMaskFn",placeholder:"_"},e.fn.extend({caret:function(e,t){var i;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof e?(t="number"==typeof t?t:e,this.each((function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&((i=this.createTextRange()).collapse(!0),i.moveEnd("character",t),i.moveStart("character",e),i.select())}))):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(i=document.selection.createRange(),e=0-i.duplicate().moveStart("character",-1e5),t=e+i.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(i,r){var s,l,c,d,u,f,h;if(!i&&this.length>0){var p=e(this[0]).data(e.mask.dataName);return p?p():void 0}return r=e.extend({autoclear:e.mask.autoclear,placeholder:e.mask.placeholder,completed:null},r),s=e.mask.definitions,l=[],c=f=i.length,d=null,e.each(i.split(""),(function(e,t){"?"==t?(f--,c=e):s[t]?(l.push(new RegExp(s[t])),null===d&&(d=l.length-1),c>e&&(u=l.length-1)):l.push(null)})),this.trigger("unmask").each((function(){function p(){if(r.completed){for(var e=d;u>=e;e++)if(l[e]&&y[e]===m(e))return;r.completed.call(w)}}function m(e){return r.placeholder.charAt(e<r.placeholder.length?e:0)}function g(e){for(;++e<f&&!l[e];);return e}function b(e,t){var i,n;if(!(0>e)){for(i=e,n=g(t);f>i;i++)if(l[i]){if(!(f>n&&l[i].test(y[n])))break;y[i]=y[n],y[n]=m(n),n=g(n)}k(),w.caret(Math.max(d,e))}}function v(){_(),w.val()!=x&&w.change()}function $(e,t){var i;for(i=e;t>i&&f>i;i++)l[i]&&(y[i]=m(i))}function k(){w.val(y.join(""))}function _(e){var t,i,n,o=w.val(),a=-1;for(t=0,n=0;f>t;t++)if(l[t]){for(y[t]=m(t);n++<o.length;)if(i=o.charAt(n-1),l[t].test(i)){y[t]=i,a=t;break}if(n>o.length){$(t+1,f);break}}else y[t]===o.charAt(n)&&n++,c>t&&(a=t);return e?k():c>a+1?r.autoclear||y.join("")===S?(w.val()&&w.val(""),$(0,f)):k():(k(),w.val(w.val().substring(0,a+1))),c?t:d}var w=e(this),y=e.map(i.split(""),(function(e,t){return"?"!=e?s[e]?m(t):e:void 0})),S=y.join(""),x=w.val();w.data(e.mask.dataName,(function(){return e.map(y,(function(e,t){return l[t]&&e!=m(t)?e:null})).join("")})),w.one("unmask",(function(){w.off(".mask").removeData(e.mask.dataName)})).on("focus.mask",(function(){var e;w.prop("readonly")||(clearTimeout(t),x=w.val(),e=_(),t=setTimeout((function(){w.get(0)===document.activeElement&&(k(),e==i.replace("?","").length?w.caret(0,e):w.caret(e))}),10))})).on("blur.mask",v).on("keydown.mask",(function(e){if(!w.prop("readonly")){var t,i,o,a=e.which||e.keyCode;h=w.val(),8===a||46===a||n&&127===a?(i=(t=w.caret()).begin,(o=t.end)-i==0&&(i=46!==a?function(e){for(;--e>=0&&!l[e];);return e}(i):o=g(i-1),o=46===a?g(o):o),$(i,o),b(i,o-1),e.preventDefault()):13===a?v.call(this,e):27===a&&(w.val(x),w.caret(0,_()),e.preventDefault())}})).on("keypress.mask",(function(t){if(!w.prop("readonly")){var i,n,o,r=t.which||t.keyCode,s=w.caret();if(!(t.ctrlKey||t.altKey||t.metaKey||32>r)&&r&&13!==r){if(s.end-s.begin!=0&&($(s.begin,s.end),b(s.begin,s.end-1)),i=g(s.begin-1),f>i&&(n=String.fromCharCode(r),l[i].test(n))){if(function(e){var t,i,n,o;for(t=e,i=m(e);f>t;t++)if(l[t]){if(n=g(t),o=y[t],y[t]=i,!(f>n&&l[n].test(o)))break;i=o}}(i),y[i]=n,k(),o=g(i),a){setTimeout((function(){e.proxy(e.fn.caret,w,o)()}),0)}else w.caret(o);s.begin<=u&&p()}t.preventDefault()}}})).on("input.mask paste.mask",(function(){w.prop("readonly")||setTimeout((function(){var e=_(!0);w.caret(e),p()}),0)})),o&&a&&w.off("input.mask").on("input.mask",(function(){var e=w.val(),t=w.caret();if(h&&h.length&&h.length>e.length){for(_(!0);t.begin>0&&!l[t.begin-1];)t.begin--;if(0===t.begin)for(;t.begin<d&&!l[t.begin];)t.begin++;w.caret(t.begin,t.begin)}else{for(_(!0);t.begin<f&&!l[t.begin];)t.begin++;w.caret(t.begin,t.begin)}p()})),_()}))}})}));